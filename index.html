<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cyber Defenders Dashboard (Lokal)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100">
<header class="sticky top-0 z-10 bg-slate-900/80 backdrop-blur border-b border-slate-800">
<div class="max-w-7xl mx-auto px-4 py-4 space-y-3">
<h1 class="text-xl font-bold">Cyber Defenders Dashboard</h1>
<div class="flex items-center gap-3">
<input id="apiBase" class="flex-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-800" placeholder="https://cyber-defenders-dashboard.<konto>.workers.dev">
<button id="saveBase" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700">Lagre</button>
<button id="testBtn" class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Test</button>
<span id="connStatus" class="text-sm"></span>
</div>
<div class="flex items-center gap-3">
<span id="last-updated" class="text-sm text-slate-300">Ikke tilkoblet</span>
<button id="refreshBtn" class="px-3 py-2 rounded-xl bg-sky-600 hover:bg-sky-500">Oppdater</button>
<button id="reportBtn" class="px-3 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500">Generer rapport</button>
<button id="speakBtn" class="px-3 py-2 rounded-xl bg-amber-600 hover:bg-amber-500" disabled>Les opp</button>
</div>
</div>
</header>
<main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
<section id="cards" class="grid md:grid-cols-2 xl:grid-cols-3 gap-4"></section>
<textarea id="report" class="w-full h-48 p-3 rounded-xl bg-slate-900 border border-slate-800" readonly></textarea>
</main>
<script>
function getApiBase(){return (localStorage.getItem('apiBase')||'').replace(/\/+$/, '');}
function setApiBase(v){localStorage.setItem('apiBase',(v||'').trim());}
async function safeFetch(url,opt={}){return fetch(url,{mode:'cors',...opt});}
const apiBaseInput=document.getElementById('apiBase');apiBaseInput.value=getApiBase();
document.getElementById('saveBase').onclick=()=>{setApiBase(apiBaseInput.value);document.getElementById('connStatus').textContent='Lagret';}
document.getElementById('testBtn').onclick=async()=>{try{const r=await safeFetch(getApiBase()+'/api/health');if(!r.ok)throw 0;document.getElementById('connStatus').textContent='OK';}catch{document.getElementById('connStatus').textContent='Feil';}};
document.getElementById('refreshBtn').onclick=()=>safeFetch(getApiBase()+'/api/refresh',{method:'POST'});
document.getElementById('reportBtn').onclick=async()=>{const r=await safeFetch(getApiBase()+'/api/report');const t=await r.text();document.getElementById('report').value=t;document.getElementById('speakBtn').disabled=false;}
document.getElementById('speakBtn').onclick=()=>{const t=document.getElementById('report').value;if(!t)return;const u=new SpeechSynthesisUtterance(t);u.lang='nb-NO';speechSynthesis.speak(u);};
</script>
</body>
</html>